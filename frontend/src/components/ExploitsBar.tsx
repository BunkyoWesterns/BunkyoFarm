import { exploitsQuery, useClientSolver, useExtendedExploitSolver } from "@/utils/queries"
import { Box, Divider, Flex, Paper, ScrollArea, Space, Tooltip } from "@mantine/core"
import { GoDotFill } from "react-icons/go"


export const ExploitBar = () => {
    const exploits = exploitsQuery()
    const extendedExploitSolver = useExtendedExploitSolver()
    const clientSolver = useClientSolver()

    return <Box style={{width:"100%", fontSize:"90%"}} >
        <b>Launched Exploits</b>
        <Space h="md" />
        <Divider />
        <Space h="lg" />
        <ScrollArea style={{width:"100%"}}>
            <Flex>
                {(exploits.data??[]).sort( (a, b) => {
                    if (a.status == "disabled" && b.status == "active")
                        return -1
                    else if (a.status == "active" && b.status == "disabled")
                        return 1
                    else
                        return b.name.localeCompare(a.name)
                } ).map((expl) => <Box>
                    <Box style={{fontSize:"90%"}}>
                        <Paper shadow="md" radius="xl" withBorder px={20} py={5} bg="gray" mx="xs">
                            <Box className="center-flex">
                                <Tooltip label={expl.status=="active"?"Active":"Inactive"} color={expl.status=="active"?"green":"red"}>
                                    <span className="center-flex"><GoDotFill color={expl.status=="active"?"green":"red"} size={30} /></span>
                                </Tooltip>
                                <Space w={3} />
                                <Box>
                                    <Box style={{ fontSize: "90%"}}>
                                        {extendedExploitSolver(expl.id)}
                                    </Box>
                                    <Box style={{ fontSize: "70%"}}>
                                        {expl.status=="active"?"running":"runned"} by: {clientSolver(expl.last_execution_by)}
                                    </Box>
                                </Box>
                            </Box>
                        </Paper>
                        
                    </Box>
                    <Space h="md" />
                    
                </Box>)}
            </Flex>
        </ScrollArea>
        
        <Space h="md" />
    </Box>
}