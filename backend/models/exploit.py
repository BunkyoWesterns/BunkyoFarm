from db import ExploitID, Language, ExploitStatus
from db import ServiceID, ClientID, UnHashedClientID, FkType, TeamID, ExploitSourceID
from pydantic import BaseModel, AwareDatetime
from models.enums import AttackExecutionStatus

###-- Exploit Models --###

class ExploitDTO(BaseModel):
    id: ExploitID
    name: str
    language: Language
    status: ExploitStatus|None = None
    last_update: AwareDatetime|None = None
    created_at: AwareDatetime
    service: FkType[ServiceID]
    created_by: FkType[ClientID]
    last_execution_by: FkType[ClientID]|None = None

class ExploitSourceDTO(BaseModel):
    id:         ExploitSourceID
    hash:       str
    message:    str|None
    pushed_at:  AwareDatetime
    pushed_by:  FkType[ClientID]
    os_type:    str|None
    distro:     str|None
    arch:       str|None
    exploit:    FkType[ExploitID]

class ExploitAddForm(BaseModel):
    id: ExploitID
    name: str
    language: Language = Language.other
    service: ServiceID
    created_by: UnHashedClientID #Only the real client can associate an exploit to it

class ExploitEditForm(BaseModel):
    name: str|None = None
    language: Language|None = None
    service: ServiceID|None = None
    created_by: UnHashedClientID|None = None #Only the real client can associate an exploit to it
    
class ExploitSubmitForm(BaseModel):
    start_time: AwareDatetime|None = None
    end_time: AwareDatetime|None = None
    status: AttackExecutionStatus
    error: bytes|None = None
    executed_by: UnHashedClientID|None = None
    target: TeamID|None = None
    flags: list[str]

class ExploitSourcePushForm(BaseModel):
    message: str|None

class ManualSubmitForm(BaseModel):
    flags: list[str]|None = None
    output: bytes|None = None