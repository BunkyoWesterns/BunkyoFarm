from db import ExploitID, Language, ExploitStatus
from db import ServiceID, ClientID, UnHashedClientID, FkType, TeamID
from pydantic import BaseModel, AwareDatetime
from models.enums import AttackExecutionStatus

###-- Exploit Models --###

class ExploitDTO(BaseModel):
    id: ExploitID
    name: str
    language: Language
    status: ExploitStatus
    last_upadte: AwareDatetime
    created_at: AwareDatetime
    service: FkType[ServiceID]
    created_by: FkType[ClientID]

class ExploitAddForm(BaseModel):
    id: ExploitID
    name: str
    language: Language = Language.other
    status: ExploitStatus = ExploitStatus.disabled
    service: ServiceID
    created_by: UnHashedClientID #Only the real client can associate an exploit to it

class ExploitEditForm(BaseModel):
    name: str|None = None
    language: Language|None = None
    status: ExploitStatus|None = None
    service: ServiceID|None = None
    created_by: UnHashedClientID|None = None #Only the real client can associate an exploit to it
    
class ExploitSubmitForm(BaseModel):
    exploit: ExploitEditForm|None = None
    start_time: AwareDatetime|None = None
    end_time: AwareDatetime|None = None
    status: AttackExecutionStatus
    error: bytes|None = None
    executed_by: UnHashedClientID|None = None
    target: TeamID|None = None
    flags: list[str]

class ManualSubmitForm(BaseModel):
    flags: list[str]|None = None
    output: bytes|None = None